<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hierodule: USART Module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hierodule
   &#160;<span id="projectnumber">1.6.2</span>
   </div>
   <div id="projectbrief">Utility module set for STM32 MCUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_u_s_a_r_t__usage.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">USART Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_USART_USAGE"></a></p>
<p>The module basically lets you</p><ul>
<li>Transmit a single byte or a string.</li>
<li>Easily assign an ISR to handle the incoming bytes.</li>
<li>Maintain a ring buffer with arbitrary length for the received data.</li>
</ul>
<p>Also provided are routines to</p><ul>
<li>Unidirectionally parse the ring buffer</li>
<li>Toggle the RXNEIE &amp; RE control bits</li>
<li>Check the RXNE &amp; TXE flags.</li>
<li>Initialize or destroy USART wrapper instances dynamically.</li>
</ul>
<p><a class="el" href="struct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper.html">HIERODULE_USART_Wrapper</a> is the main item in the module, with which you can access the variables related to the ring buffer and use the module routines to implement your RXNE ISR.</p>
<p>The module does not address peripheral configuration and initialization, it is assumed those are performed beforehand. Make sure to have configured the baudrate and GPIO modes of the pins for your peripheral.</p>
<p>Also notice that the USART IRQs are defined in the module's source file. The compiler will throw a multiple definition error if an IRQ is defined somewhere else.</p>
<p>To start using the module, first thing you need is a double pointer to <a class="el" href="struct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper.html">HIERODULE_USART_Wrapper</a> to create an instance for the USART peripheral. </p><div class="fragment"><div class="line"><a class="code" href="struct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper.html">HIERODULE_USART_Wrapper</a> **My_USART1_Wrapper = NULL;</div>
<div class="ttc" id="astruct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper_html"><div class="ttname"><a href="struct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper.html">HIERODULE_USART_Wrapper</a></div><div class="ttdoc">Struct that keeps variables for the ring buffer, a pointer to the USART peripheral and a pointer to t...</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8h_source.html#l00042">hierodule_usart.h:43</a></div></div>
</div><!-- fragment --><p> It has to be a double pointer, since the wrapper initializer passes you the wrapper pointer defined in the module by reference. The wrapper instance is handled in the module with a pointer and not with a variable of type <a class="el" href="struct_h_i_e_r_o_d_u_l_e___u_s_a_r_t___wrapper.html">HIERODULE_USART_Wrapper</a>, since you use pointers for dynamic memory allocation. <br  />
<br  />
Secondly, you need a void function with a uint8_t parameter for the RXNE ISR. You might as well just pass NULL if you intend to use the received data somewhere else. Or you can even maintain an array for the function pointers (i.e. void (*)(uint8_t)) to switch between ISRs on the fly. <br  />
Here's a simple example that assigns a task to the ISR that sums up the bytes received at USART1 and initializes the wrapper for USART1 with a ring buffer that's 12 bytes long. <br  />
 </p><div class="fragment"><div class="line">uint32_t Acc = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Add(uint8_t NewValue)</div>
<div class="line">{</div>
<div class="line">    Acc += NewValue;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">...</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line">My_USART1_Wrapper = <a class="code" href="group___u_s_a_r_t___public.html#gaef754239b215be20446115965672199c">HIERODULE_USART_InitWrapper</a>(USART1, 12, Add);</div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_gaef754239b215be20446115965672199c"><div class="ttname"><a href="group___u_s_a_r_t___public.html#gaef754239b215be20446115965672199c">HIERODULE_USART_InitWrapper</a></div><div class="ttdeci">HIERODULE_USART_Wrapper ** HIERODULE_USART_InitWrapper(USART_TypeDef *USART, uint16_t RX_BufferSize, void(*RX_Handler)(uint8_t))</div><div class="ttdoc">Initializes a wrapper for the specified USART peripheral.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00087">hierodule_usart.c:88</a></div></div>
</div><!-- fragment --><p> <br  />
Once initialized, the wrapper may be used to transmit data. </p><div class="fragment"><div class="line">uint8_t SingleByte = <span class="charliteral">&#39;!&#39;</span>;</div>
<div class="line"><a class="code" href="group___u_s_a_r_t___public.html#ga2c68c673805123163670e9a1d9b0f239">HIERODULE_USART_TransmitByte</a>(*My_USART1_Wrapper, SingleByte);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group___u_s_a_r_t___public.html#gab8ba1380833803d3d09bf626996cd8a1">HIERODULE_USART_TransmitString</a>(*My_USART1_Wrapper, <span class="stringliteral">&quot;Hello World!\n&quot;</span>);</div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_ga2c68c673805123163670e9a1d9b0f239"><div class="ttname"><a href="group___u_s_a_r_t___public.html#ga2c68c673805123163670e9a1d9b0f239">HIERODULE_USART_TransmitByte</a></div><div class="ttdeci">void HIERODULE_USART_TransmitByte(HIERODULE_USART_Wrapper *Wrapper, uint8_t Byte)</div><div class="ttdoc">Transmits a single byte.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00255">hierodule_usart.c:255</a></div></div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_gab8ba1380833803d3d09bf626996cd8a1"><div class="ttname"><a href="group___u_s_a_r_t___public.html#gab8ba1380833803d3d09bf626996cd8a1">HIERODULE_USART_TransmitString</a></div><div class="ttdeci">void HIERODULE_USART_TransmitString(HIERODULE_USART_Wrapper *Wrapper, char *String)</div><div class="ttdoc">Transmits a string.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00279">hierodule_usart.c:279</a></div></div>
</div><!-- fragment --><p> <br  />
You need to enable the RE and RXNEIE bits at the control register to enable the USART IRQ and start receiving data. Simply call: </p><div class="fragment"><div class="line"><a class="code" href="group___u_s_a_r_t___public.html#gac9404eb4466fafb6a3a7238e0c7c1368">HIERODULE_USART_Enable_IT_RXNE</a>(*My_USART1_Wrapper);</div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_gac9404eb4466fafb6a3a7238e0c7c1368"><div class="ttname"><a href="group___u_s_a_r_t___public.html#gac9404eb4466fafb6a3a7238e0c7c1368">HIERODULE_USART_Enable_IT_RXNE</a></div><div class="ttdeci">void HIERODULE_USART_Enable_IT_RXNE(HIERODULE_USART_Wrapper *Wrapper)</div><div class="ttdoc">Enables the RX not empty interrupt of the USART peripheral , also enables the RE bit of the control r...</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00187">hierodule_usart.c:187</a></div></div>
</div><!-- fragment --><p> <br  />
You can also disable the receive control bits via: </p><div class="fragment"><div class="line"><a class="code" href="group___u_s_a_r_t___public.html#gac13b2db4154ec786698f3c6c2efa67fe">HIERODULE_USART_Disable_IT_RXNE</a>(*My_USART1_Wrapper);</div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_gac13b2db4154ec786698f3c6c2efa67fe"><div class="ttname"><a href="group___u_s_a_r_t___public.html#gac13b2db4154ec786698f3c6c2efa67fe">HIERODULE_USART_Disable_IT_RXNE</a></div><div class="ttdeci">void HIERODULE_USART_Disable_IT_RXNE(HIERODULE_USART_Wrapper *Wrapper)</div><div class="ttdoc">Disables the RX not empty interrupt of the USART peripheral , also disables the RE bit of the control...</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00195">hierodule_usart.c:195</a></div></div>
</div><!-- fragment --><p> <br  />
You can "release" the instance of your wrapper to free memory:</p><div class="fragment"><div class="line"><a class="code" href="group___u_s_a_r_t___public.html#ga93c36c54fc778638ec89051471f3ed75">HIERODULE_USART_ReleaseWrapper</a>(*My_USART1_Wrapper); </div>
<div class="ttc" id="agroup___u_s_a_r_t___public_html_ga93c36c54fc778638ec89051471f3ed75"><div class="ttname"><a href="group___u_s_a_r_t___public.html#ga93c36c54fc778638ec89051471f3ed75">HIERODULE_USART_ReleaseWrapper</a></div><div class="ttdeci">void HIERODULE_USART_ReleaseWrapper(HIERODULE_USART_Wrapper *Wrapper)</div><div class="ttdoc">Frees the memory allocated to a USART wrapper and clears USART status flags and control bits.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__usart_8c_source.html#l00164">hierodule_usart.c:164</a></div></div>
</div><!-- fragment --><p> Keep in mind this only frees the wrapper pointer in the module and not your double pointer that points to it. It's best to free and nullify that, as well:</p><div class="fragment"><div class="line">free(My_USART1_Wrapper); </div>
</div><!-- fragment --><div class="fragment"><div class="line">My_USART1_Wrapper = NULL; </div>
</div><!-- fragment --><p> Notice that trying to access a freed memory address might turn out ugly for your run-time. However, you can reuse your double pointer to re-initialize the USART peripheral after releasing it. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
