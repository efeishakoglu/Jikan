<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hierodule: ADC Module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hierodule
   &#160;<span id="projectnumber">1.5.0</span>
   </div>
   <div id="projectbrief">Utility module set for STM32 MCUs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_a_d_c__usage.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADC Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_ADC_USAGE"></a> The module lets you easily assign an ISR to handle the data received at the ADC peripheral. <br  />
<br  />
 <a class="el" href="struct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper.html">HIERODULE_ADC_Wrapper</a> is the main item in the module, with which you can access the variables related to the data received to implement your EOC ISR. <br  />
<br  />
 The module does not address peripheral configuration and initialization, it is assumed those are performed beforehand. Enable continuous conversion mode for the ADC channel you intend to use for exactly one conversion/rank. <br  />
<br  />
 Also notice that the ADC IRQs are defined in the module's source file. The compiler will throw a multiple definition error if an IRQ is defined somewhere else. <br  />
<br  />
 Create a double pointer to <a class="el" href="struct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper.html">HIERODULE_ADC_Wrapper</a> to create an instance for the ADC peripheral. </p><div class="fragment"><div class="line"><a class="code" href="struct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper.html">HIERODULE_ADC_Wrapper</a> **<a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a> = NULL;</div>
<div class="ttc" id="agroup___a_d_c___private_html_gadb7acec4931a0539c7f315eeb662c883"><div class="ttname"><a href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a></div><div class="ttdeci">static HIERODULE_ADC_Wrapper * ADC1_Wrapper</div><div class="ttdoc">ADC wrapper pointer meant for ADC1.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8c_source.html#l00027">hierodule_adc.c:27</a></div></div>
<div class="ttc" id="astruct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper_html"><div class="ttname"><a href="struct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper.html">HIERODULE_ADC_Wrapper</a></div><div class="ttdoc">Struct that keeps variables for the ADC data, a pointer to the ADC peripheral and a pointer to the IS...</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8h_source.html#l00046">hierodule_adc.h:47</a></div></div>
</div><!-- fragment --><p> It has to be a double pointer, since the wrapper initializer passes you the wrapper pointer defined in the module by reference. The wrapper instance is handled in the module with a pointer and not with a variable of type <a class="el" href="struct_h_i_e_r_o_d_u_l_e___a_d_c___wrapper.html">HIERODULE_ADC_Wrapper</a>, since you use pointers for dynamic memory allocation. <br  />
<br  />
Secondly, you need a void function with a uint16_t parameter for the EOC ISR. You might as well just pass NULL if you intend to use the received data somewhere else. Or you can even maintain an array for the function pointers (i.e. void (*)(uint16_t)) to switch between ISRs on the fly. <br  />
<br  />
Here's a simple example that assigns a task to the ISR that accumulates the data received at the ADC peripheral and initializes the wrapper for ADC1 with a filter weight of 0.75. <br  />
 </p><div class="fragment"><div class="line">uint32_t Acc = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Add(uint16_t NewValue)</div>
<div class="line">{</div>
<div class="line">    Acc += NewValue;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">...</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a> = <a class="code" href="group___a_d_c___public.html#ga210f0c3fe688d1187fc98e4e40689f92">HIERODULE_ADC_InitWrapper</a>(ADC1, 12, Add);</div>
<div class="line">(*ADC1_Wrapper)-&gt;FilterWeight = 0.75;</div>
<div class="ttc" id="agroup___a_d_c___public_html_ga210f0c3fe688d1187fc98e4e40689f92"><div class="ttname"><a href="group___a_d_c___public.html#ga210f0c3fe688d1187fc98e4e40689f92">HIERODULE_ADC_InitWrapper</a></div><div class="ttdeci">HIERODULE_ADC_Wrapper ** HIERODULE_ADC_InitWrapper(ADC_TypeDef *_ADC, void(*ISR)(uint16_t))</div><div class="ttdoc">Initializes a wrapper for the specified ADC peripheral.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8c_source.html#l00067">hierodule_adc.c:67</a></div></div>
</div><!-- fragment --><p> <br  />
If you do not want your data filtered, simply comment out the macro constant definition <a class="el" href="group___a_d_c___public.html#ga6de048dc6a9557209d4380b03bb8672b">HIERODULE_ADC_SMOOTHENING_FILTER</a> in the header file, like so: </p><div class="fragment"><div class="line"><span class="comment">//#define HIERODULE_ADC_SMOOTHENING_FILTER</span></div>
</div><!-- fragment --><p> <br  />
ADC conversion and ISR action will start once you enable the peripheral: </p><div class="fragment"><div class="line"><a class="code" href="group___a_d_c___public.html#ga46ecd925af044e69b67e585963710f74">HIERODULE_ADC_Enable</a>(*<a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a>);</div>
<div class="ttc" id="agroup___a_d_c___public_html_ga46ecd925af044e69b67e585963710f74"><div class="ttname"><a href="group___a_d_c___public.html#ga46ecd925af044e69b67e585963710f74">HIERODULE_ADC_Enable</a></div><div class="ttdeci">void HIERODULE_ADC_Enable(HIERODULE_ADC_Wrapper *Wrapper)</div><div class="ttdoc">Updates relevant control register bits to start ADC action.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8c_source.html#l00118">hierodule_adc.c:118</a></div></div>
</div><!-- fragment --><p> <br  />
Likewise, you can halt the process via: </p><div class="fragment"><div class="line"><a class="code" href="group___a_d_c___public.html#gaf81fbff1c7fcd1b761d9e66fefbb2f1a">HIERODULE_ADC_Disable</a>(*<a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a>);</div>
<div class="ttc" id="agroup___a_d_c___public_html_gaf81fbff1c7fcd1b761d9e66fefbb2f1a"><div class="ttname"><a href="group___a_d_c___public.html#gaf81fbff1c7fcd1b761d9e66fefbb2f1a">HIERODULE_ADC_Disable</a></div><div class="ttdeci">void HIERODULE_ADC_Disable(HIERODULE_ADC_Wrapper *Wrapper)</div><div class="ttdoc">Updates relevant control register bits to stop ADC action.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8c_source.html#l00146">hierodule_adc.c:146</a></div></div>
</div><!-- fragment --><p> <br  />
You can "release" the instance of your wrapper to free memory:</p><div class="fragment"><div class="line"><a class="code" href="group___a_d_c___public.html#gad2688eb7fcc064a7b30ea979ae4ca721">HIERODULE_ADC_ReleaseWrapper</a>(*<a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a>); </div>
<div class="ttc" id="agroup___a_d_c___public_html_gad2688eb7fcc064a7b30ea979ae4ca721"><div class="ttname"><a href="group___a_d_c___public.html#gad2688eb7fcc064a7b30ea979ae4ca721">HIERODULE_ADC_ReleaseWrapper</a></div><div class="ttdeci">void HIERODULE_ADC_ReleaseWrapper(HIERODULE_ADC_Wrapper *Wrapper)</div><div class="ttdoc">Frees the memory allocated to an ADC wrapper.</div><div class="ttdef"><b>Definition:</b> <a href="hierodule__adc_8c_source.html#l00108">hierodule_adc.c:108</a></div></div>
</div><!-- fragment --><p> Keep in mind this only frees the wrapper pointer in the module and not your double pointer that points to it. It's best to free and nullify that, as well:</p><div class="fragment"><div class="line">free(<a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a>); </div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="group___a_d_c___private.html#gadb7acec4931a0539c7f315eeb662c883">ADC1_Wrapper</a> = NULL; </div>
</div><!-- fragment --><p> Notice that trying to access a freed memory address might turn out ugly for your run-time. However, you can reuse your double pointer to re-initialize the ADC peripheral after releasing it. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
